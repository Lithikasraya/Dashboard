<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Air Quality Monitoring Dashboard</title>
  <style>
    :root {
      --bg-color: #f4f4f9;
      --text-color: #222;
      --box-bg: rgba(255, 255, 255, 0.15);
      --box-border: rgba(255, 255, 255, 0.3);
      --shadow: rgba(0,0,0,0.2);
    }
    body.dark {
      --bg-color: #0d1117;
      --text-color: #eee;
      --box-bg: rgba(20, 20, 20, 0.3);
      --box-border: rgba(255, 255, 255, 0.2);
      --shadow: rgba(0,0,0,0.6);
    }
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background: var(--bg-color);
      color: var(--text-color);
      transition: background 0.3s, color 0.3s;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 30px;
      background: var(--bg-color); /* âœ… Same as page background */
      color: var(--text-color);
      border-bottom: 1px solid var(--box-border);
      box-shadow: 0 2px 8px var(--shadow);
    }
    header h1 {
      font-size: 20px;
      letter-spacing: 1px;
    }
    header img {
      height: 50px;
      border-radius: 8px;
    }
    .theme-toggle {
      cursor: pointer;
      background: transparent;
      border: 2px solid var(--text-color);
      border-radius: 8px;
      padding: 5px 10px;
      color: var(--text-color);
      font-size: 14px;
      transition: background 0.3s;
    }
    .theme-toggle:hover {
      background: rgba(0,0,0,0.1);
    }

    /* Dashboard */
    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 20px;
      padding: 20px;
    }
    .box {
      backdrop-filter: blur(10px);
      background: var(--box-bg);
      border: 1px solid var(--box-border);
      border-radius: 15px;
      padding: 20px;
      text-align: center;
      font-size: 18px;
      font-weight: bold;
      box-shadow: 0px 4px 10px var(--shadow);
      transition: transform 0.2s, background 0.3s;
    }
    .box:hover {
      transform: translateY(-5px) scale(1.03);
    }

    /* Graphs */
    .graph-section {
      padding: 20px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
    }
    canvas {
      backdrop-filter: blur(8px);
      background: var(--box-bg);
      border: 1px solid var(--box-border);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0px 4px 12px var(--shadow);
      width: 100%;
      height: 300px;
    }

    /* Mobile */
    @media (max-width: 768px) {
      .graph-section {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Air Quality Monitoring Dashboard</h1>
    <div>
      <button class="theme-toggle" onclick="toggleTheme()">ðŸŒ™ Toggle</button>
      <img src="https://i.ibb.co/hRM3LMv9/white-logo-removebg-preview.png" alt="Kietsmartcity">
    </div>
  </header>

  <!-- Top 5 Boxes -->
  <div class="dashboard">
    <div class="box" id="box-pm25">PM2.5: <span id="pm25">--</span></div>
    <div class="box" id="box-pm10">PM10: <span id="pm10">--</span></div>
    <div class="box" id="box-humidity">Humidity: <span id="humidity">--</span></div>
    <div class="box" id="box-temp">Temperature: <span id="temperature">--</span></div>
    <div class="box" id="box-noise">Noise: <span id="noise">--</span></div>
  </div>

  <!-- Graphs -->
  <div class="graph-section">
    <canvas id="pm25Chart"></canvas>
    <canvas id="pm10Chart"></canvas>
    <canvas id="humidityChart"></canvas>
    <canvas id="temperatureChart"></canvas>
    <canvas id="noiseChart"></canvas>
  </div>

  <!-- âœ… Correct Chart.js script -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Theme toggle
    function toggleTheme() {
      document.body.classList.toggle("dark");
    }

    // ThingSpeak API details
    const channelID = "3063550"; 
    const readAPIKey = "AXHRNGPKTEO1TU2P"; 
    const url = `https://api.thingspeak.com/channels/${channelID}/feeds.json?api_key=${readAPIKey}&results=20`;

    // Create chart function
    function createChart(ctxId, label, color) {
      return new Chart(document.getElementById(ctxId), {
        type: 'line',
        data: {
          labels: [],
          datasets: [{
            label: label,
            data: [],
            borderColor: color,
            backgroundColor: color + "33",
            fill: true,
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: { title: { display: true, text: "Time" }},
            y: { beginAtZero: true }
          }
        }
      });
    }

    // Initialize charts
    const pm25Chart = createChart("pm25Chart","PM2.5","#28a745");
    const pm10Chart = createChart("pm10Chart","PM10","#ff9800");
    const humidityChart = createChart("humidityChart","Humidity","#2196f3");
    const temperatureChart = createChart("temperatureChart","Temperature","#e53935");
    const noiseChart = createChart("noiseChart","Noise","#9c27b0");

    // Fetch data from ThingSpeak
    async function fetchData() {
      const res = await fetch(url);
      const data = await res.json();
      const feeds = data.feeds;

      let labels = feeds.map(f => new Date(f.created_at).toLocaleTimeString());
      let pm25 = feeds.map(f => f.field1);
      let pm10 = feeds.map(f => f.field2);
      let humidity = feeds.map(f => f.field3);
      let temperature = feeds.map(f => f.field4);
      let noise = feeds.map(f => f.field5);

      updateChart(pm25Chart, labels, pm25);
      updateChart(pm10Chart, labels, pm10);
      updateChart(humidityChart, labels, humidity);
      updateChart(temperatureChart, labels, temperature);
      updateChart(noiseChart, labels, noise);

      // Update dashboard values
      document.getElementById("pm25").textContent = pm25[pm25.length-1] || "--";
      document.getElementById("pm10").textContent = pm10[pm10.length-1] || "--";
      document.getElementById("humidity").textContent = humidity[humidity.length-1] || "--";
      document.getElementById("temperature").textContent = temperature[temperature.length-1] || "--";
      document.getElementById("noise").textContent = noise[noise.length-1] || "--";
    }

    function updateChart(chart, labels, data) {
      chart.data.labels = labels;
      chart.data.datasets[0].data = data;
      chart.update();
    }

    fetchData();
    setInterval(fetchData, 15000);
  </script>
</body>
</html>
